import { ImageResponse } from "@vercel/og"
import { ogImageSchema } from "@/lib/validations/og"
export const runtime = "edge"

const interRegular = fetch(
  new URL("../../../assets/fonts/Inter-Regular.ttf", import.meta.url)
).then((res) => res.arrayBuffer())

const interBold = fetch(
  new URL("../../../assets/fonts/CalSans-SemiBold.ttf", import.meta.url)
).then((res) => res.arrayBuffer())

export async function GET(req: Request) {
  try {
    const fontRegular = await interRegular
    const fontBold = await interBold

    const url = new URL(req.url)
    const values = ogImageSchema.parse(Object.fromEntries(url.searchParams))
    const heading =
      values.heading.length > 140
        ? `${values.heading.substring(0, 140)}...`
        : values.heading

    const { mode } = values
    const paint = mode === "dark" ? "#fff" : "#000"

    const fontSize = heading.length > 100 ? "70px" : "100px"

    return new ImageResponse(
      (
        <div
          tw="flex relative flex-col p-12 w-full h-full items-start"
          style={{
            color: paint,
            background:
              mode === "dark"
                ? "linear-gradient(90deg, #000 0%, #111 100%)"
                : "white",
          }}
        >

          <svg width="301" height="58" viewBox="0 0 301 58" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M37.3792 35.8232H27.1902L24.9536 30.5446L23.6116 34.1799L20.5798 25.9134L17.4983 34.1799L16.1066 30.5446L14.1682 35.8232H3.63135L20.6792 6.54199L37.3792 35.8232Z" fill="#FFE5BF" />
            <path d="M32.1695 9.51981C34.2252 9.51981 35.8916 7.85333 35.8916 5.79763C35.8916 3.74192 34.2252 2.07544 32.1695 2.07544C30.1137 2.07544 28.4473 3.74192 28.4473 5.79763C28.4473 7.85333 30.1137 9.51981 32.1695 9.51981Z" fill="#ED9155" />
            <path d="M0 5.1885C0 2.32297 2.32297 0 5.1885 0H51.885C54.7505 0 57.0735 2.32297 57.0735 5.1885V51.885C57.0735 54.7505 54.7505 57.0735 51.885 57.0735H5.1885C2.32297 57.0735 0 54.7505 0 51.885V5.1885Z" fill="black" />
            <path d="M45.1629 45.1623H34.9739L32.7373 39.8837L31.3953 43.519L28.3635 35.2525L25.282 43.519L23.8903 39.8837L21.9519 45.1623H11.415L28.4629 15.8811L45.1629 45.1623Z" fill="#FFE5BF" />
            <path d="M39.9522 18.8589C42.0079 18.8589 43.6744 17.1924 43.6744 15.1367C43.6744 13.081 42.0079 11.4146 39.9522 11.4146C37.8965 11.4146 36.23 13.081 36.23 15.1367C36.23 17.1924 37.8965 18.8589 39.9522 18.8589Z" fill="#ED9155" />
            <path d="M72.1201 45.856V10.5566H96.147V17.1719H80.6936V25.5866H94.0301V32.3078H80.6936V45.856H72.1201Z" fill="black" />
            <path d="M102.197 45.856V19.4476H110.082L110.135 45.856H102.197ZM102.038 15.4255V9.33936H110.188V15.4255H102.038Z" fill="black" />
            <path d="M117.181 45.856V21.882C117.675 21.4587 118.557 20.9824 119.827 20.4531C121.097 19.8886 122.544 19.3947 124.167 18.9713C125.825 18.5126 127.483 18.2833 129.141 18.2833C130.8 18.2833 132.105 18.4068 133.058 18.6538C134.01 18.9007 134.734 19.2183 135.228 19.6064V25.3749C134.628 25.2338 133.869 25.128 132.952 25.0574C132.035 24.9868 131.082 24.9516 130.094 24.9516C129.106 24.9163 128.171 24.9163 127.289 24.9516C126.407 24.9868 125.666 25.0574 125.066 25.1632V45.856H117.181Z" fill="black" />
            <path d="M151.007 46.6499C148.325 46.6499 145.944 46.103 143.862 45.0093C141.816 43.8802 140.211 42.2926 139.046 40.2462C137.917 38.1646 137.353 35.6949 137.353 32.837C137.353 28.1798 138.499 24.5811 140.793 22.0408C143.121 19.4652 146.438 18.1775 150.742 18.1775C153.706 18.1775 156.087 18.8125 157.887 20.0827C159.721 21.3528 161.062 23.2051 161.909 25.6396C162.756 28.074 163.161 31.0377 163.126 34.5306H142.751L141.904 29.5029H156.617L155.452 31.9903C155.417 29.1325 155.011 27.1214 154.235 25.9571C153.459 24.7928 152.189 24.2106 150.425 24.2106C149.437 24.2106 148.537 24.4576 147.726 24.9516C146.949 25.4455 146.332 26.2746 145.873 27.4389C145.45 28.5679 145.238 30.138 145.238 32.149C145.238 34.6893 145.838 36.6475 147.038 38.0235C148.272 39.3995 150.231 40.0875 152.912 40.0875C153.9 40.0875 154.87 39.9816 155.823 39.7699C156.811 39.5229 157.728 39.2407 158.575 38.9232C159.422 38.6056 160.145 38.3234 160.745 38.0764V44.8505C159.474 45.3797 158.046 45.8031 156.458 46.1206C154.905 46.4735 153.088 46.6499 151.007 46.6499Z" fill="black" />
            <path d="M181.148 46.544C179.242 46.544 177.443 46.2618 175.749 45.6973C174.056 45.1328 172.556 44.286 171.251 43.157C169.946 42.028 168.922 40.599 168.181 38.8702C167.441 37.1414 167.07 35.1304 167.07 32.837C167.07 30.4026 167.423 28.2857 168.129 26.4863C168.834 24.6517 169.804 23.1345 171.039 21.935C172.309 20.7354 173.791 19.8357 175.485 19.2359C177.178 18.6361 179.048 18.3362 181.095 18.3362C182.541 18.3362 184.023 18.495 185.54 18.8125C187.093 19.0948 188.451 19.5005 189.615 20.0297V26.8039C188.38 26.2393 187.163 25.7807 185.963 25.4279C184.799 25.0398 183.6 24.8457 182.365 24.8457C180.142 24.8457 178.343 25.4102 176.967 26.5392C175.626 27.633 174.956 29.4323 174.956 31.9374C174.956 34.5835 175.555 36.5769 176.755 37.9176C177.955 39.2583 179.948 39.9287 182.735 39.9287C184.041 39.9287 185.293 39.6994 186.493 39.2407C187.728 38.782 188.786 38.3057 189.668 37.8118V44.533C188.433 45.168 187.145 45.662 185.805 46.0148C184.464 46.3676 182.912 46.544 181.148 46.544Z" fill="black" />
            <path d="M205.49 46.6499C203.867 46.6499 202.332 46.4911 200.885 46.1736C199.474 45.8913 198.221 45.415 197.128 44.7447C196.069 44.039 195.24 43.1041 194.64 41.9398C194.041 40.7402 193.741 39.2583 193.741 37.4942C193.741 35.836 194.076 34.3894 194.746 33.1546C195.452 31.9197 196.51 30.9671 197.922 30.2968C199.333 29.6264 201.115 29.2912 203.267 29.2912C204.466 29.2912 205.631 29.4147 206.76 29.6617C207.889 29.9086 208.894 30.2438 209.776 30.6672C210.694 31.0906 211.417 31.5493 211.946 32.0432L212.264 35.8536C211.558 35.4303 210.711 35.0951 209.723 34.8481C208.735 34.6011 207.677 34.4776 206.548 34.4776C204.819 34.4776 203.549 34.7423 202.738 35.2715C201.961 35.7654 201.573 36.5593 201.573 37.653C201.573 38.3234 201.767 38.9232 202.155 39.4524C202.543 39.9816 203.055 40.3874 203.69 40.6696C204.36 40.9519 205.048 41.093 205.754 41.093C207.553 41.093 208.806 40.9695 209.512 40.7225C210.253 40.4756 210.623 39.9816 210.623 39.2407V29.3971C210.623 27.7741 210.094 26.6098 209.035 25.9042C208.012 25.1632 206.548 24.7928 204.643 24.7928C203.09 24.7928 201.52 25.075 199.933 25.6396C198.38 26.1688 197.11 26.8215 196.122 27.5977V20.6119C197.039 20.0474 198.451 19.5182 200.356 19.0242C202.296 18.5303 204.466 18.2833 206.865 18.2833C207.712 18.2833 208.647 18.3539 209.67 18.495C210.694 18.6361 211.717 18.9007 212.74 19.2888C213.763 19.6416 214.698 20.1709 215.545 20.8765C216.427 21.5821 217.132 22.4818 217.662 23.5756C218.191 24.6693 218.456 26.0277 218.456 27.6506L218.403 40.2991C218.403 41.8163 217.891 43.0511 216.868 44.0037C215.845 44.9211 214.363 45.5914 212.422 46.0148C210.517 46.4382 208.206 46.6499 205.49 46.6499Z" fill="black" />
            <path d="M250.329 27.8623V45.856H242.444V29.45C242.444 28.7796 242.338 28.1622 242.126 27.5977C241.95 27.0332 241.667 26.5569 241.279 26.1688C240.891 25.7454 240.362 25.4279 239.692 25.2162C239.021 24.9692 238.21 24.8457 237.257 24.8457C236.446 24.8457 235.687 24.9516 234.982 25.1632C234.311 25.3397 233.764 25.5337 233.341 25.7454V45.856H225.455V21.3528C226.126 21 227.008 20.6472 228.102 20.2944C229.195 19.9063 230.395 19.5711 231.7 19.2888C233.006 19.0066 234.311 18.7772 235.617 18.6008C236.957 18.4244 238.192 18.3362 239.321 18.3362C241.72 18.3362 243.731 18.6538 245.354 19.2888C247.013 19.8886 248.247 20.8765 249.059 22.2525C249.906 23.6285 250.329 25.4984 250.329 27.8623ZM242.232 23.1522C243.326 22.1996 244.649 21.3705 246.201 20.6648C247.754 19.9239 249.394 19.3594 251.123 18.9713C252.852 18.5479 254.457 18.3362 255.939 18.3362C258.338 18.3362 260.349 18.6538 261.972 19.2888C263.63 19.8886 264.865 20.8765 265.677 22.2525C266.523 23.6285 266.947 25.4984 266.947 27.8623V45.856H259.061V29.45C259.061 28.7796 258.956 28.1622 258.744 27.5977C258.567 27.0332 258.285 26.5569 257.897 26.1688C257.509 25.7454 256.98 25.4279 256.309 25.2162C255.639 24.9692 254.828 24.8457 253.875 24.8457C253.063 24.8457 252.305 24.9692 251.599 25.2162C250.929 25.4279 250.382 25.7101 249.959 26.0629L242.232 23.1522Z" fill="black" />
            <path d="M288.381 46.6499C287.852 46.6499 287.076 46.597 286.053 46.4911C285.03 46.3853 283.971 46.1559 282.877 45.8031C281.784 45.415 280.849 44.8329 280.072 44.0567L281.66 41.5693V55.435H273.933V24.7399C273.933 23.5756 274.269 22.5877 274.939 21.7762C275.609 20.9647 276.527 20.2944 277.691 19.7651C278.855 19.2359 280.196 18.8478 281.713 18.6008C283.265 18.3186 284.924 18.1775 286.688 18.1775C289.369 18.1775 291.715 18.6361 293.727 19.5534C295.773 20.4355 297.361 21.935 298.49 24.0519C299.654 26.1688 300.236 29.0619 300.236 32.7312C300.236 35.4832 299.76 37.9176 298.807 40.0345C297.855 42.1162 296.496 43.7391 294.732 44.9034C293.003 46.0677 290.886 46.6499 288.381 46.6499ZM286.053 40.2991C287.464 40.2991 288.628 40.0522 289.546 39.5582C290.463 39.0643 291.151 38.2528 291.61 37.1238C292.104 35.9595 292.351 34.4071 292.351 32.4666C292.351 30.8436 292.174 29.4676 291.821 28.3386C291.469 27.2096 290.851 26.3452 289.969 25.7454C289.122 25.1103 287.923 24.7928 286.37 24.7928C284.677 24.7928 283.46 24.9692 282.719 25.322C282.013 25.6396 281.66 26.0629 281.66 26.5922V39.1878C282.331 39.5759 283.071 39.8581 283.883 40.0345C284.694 40.2109 285.418 40.2991 286.053 40.2991Z" fill="black" />
          </svg>

          <div tw="flex flex-col flex-1 py-10">
            <div
              tw="flex text-xl uppercase font-bold tracking-tight"
              style={{ fontFamily: "Inter", fontWeight: "normal" }}
            >
              {values.type}
            </div>
            <div
              tw="flex leading-[1.1] text-[80px] font-bold"
              style={{
                fontFamily: "Cal Sans",
                fontWeight: "bold",
                marginLeft: "-3px",
                fontSize,
              }}
            >
              {heading}
            </div>
          </div>
          <div tw="flex items-center w-full justify-between">
            <div
              tw="flex text-xl"
              style={{ fontFamily: "Inter", fontWeight: "normal" }}
            >
              firecamp.dev
            </div>
            <div
              tw="flex items-center text-xl"
              style={{ fontFamily: "Inter", fontWeight: "normal" }}
            >
              <svg width="32" height="32" viewBox="0 0 48 48" fill="none">
                <path
                  d="M30 44v-8a9.6 9.6 0 0 0-2-7c6 0 12-4 12-11 .16-2.5-.54-4.96-2-7 .56-2.3.56-4.7 0-7 0 0-2 0-6 3-5.28-1-10.72-1-16 0-4-3-6-3-6-3-.6 2.3-.6 4.7 0 7a10.806 10.806 0 0 0-2 7c0 7 6 11 12 11a9.43 9.43 0 0 0-1.7 3.3c-.34 1.2-.44 2.46-.3 3.7v8"
                  stroke={paint}
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                />
                <path
                  d="M18 36c-9.02 4-10-4-14-4"
                  stroke={paint}
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                />
              </svg>
              <div tw="flex ml-2">github.com/firecampdev/firecamp</div>
            </div>
          </div>
        </div>
      ),
      {
        width: 1200,
        height: 630,
        fonts: [
          {
            name: "Inter",
            data: fontRegular,
            weight: 400,
            style: "normal",
          },
          {
            name: "Cal Sans",
            data: fontBold,
            weight: 700,
            style: "normal",
          },
        ],
      }
    )
  } catch (error) {
    return new Response(`Failed to generate image`, {
      status: 500,
    })
  }
}